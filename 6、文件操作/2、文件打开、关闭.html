<html>
<head>
  <title>2、文件打开、关闭</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601967 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5196"/>
<h1>2、文件打开、关闭</h1>

<div>
<span><div><div><font style="font-size: 36pt;"><span style="font-size: 36pt; font-weight: bold;">文件打开、关闭</span></font></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">文件指针</span></div><ul><li><div>并不指向实际的文件，而是指向一个包含文件信息的数据对象，其中包含操作文件的I/O函数所用的缓冲区信息。</div></li><li><div><span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">FILE类型指针，定义在&lt;stdio.h&gt;头文件中。</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>typedef struct _iobuf {</div><div>    char *_ptr;            // 下一个要被读取的字符地址</div><div>    int   _cnt;            // 剩余的字符，如果是输入缓冲区，则表示缓冲区中还有多少个字符未被读取。</div><div>    char *_base;           // 缓冲区基地址</div><div>    int   _flag;           // 读写状态标志位</div><div>    int   _file;           // 文件描述符id</div><div>    int   _charbuf;        // 检查缓冲区状况，如果无缓冲区则不读取。</div><div>    int   _bufsiz;         // 文件缓冲区大小</div><div>    char *_tmpfname;       // 临时文件名</div><div>} FILE;</div><div><span style="font-weight: bold;"><br/></span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">文件开启&amp;关闭</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;stdio.h&gt;</div><div><br/></div><div>char *getfile(char *fname,char *mode)</div><div>{</div><div><span>    </span>FILE *fp;                             <b>// 文件指针</b></div><div><br/></div><div>    fp = fopen(fname,mode);               <b>// 打开文件</b></div><div><br/></div><div>    if(fp == NULL)                        <b>// 判断文件是否能正常打开</b></div><div>    {</div><div>        printf(&quot;打开文件%s错误。\n&quot;,fname);</div><div>        perror(&quot;fopen&quot;);                  <b>// 定位函数失败的原因</b></div><div><span>    </span><span>    return NULL;</span><br/></div><div>    }</div><div><br/></div><div>    <b>// 文件的其他各个操作</b></div><div><br/></div><div>    fclose(fp);                            <b>// 文件关闭</b><br/></div><div>}</div><div><br/></div><div>int main()</div><div>{</div><div><span>    </span>getfile(&quot;&lt;&gt;.txt&quot;,&quot;r+&quot;);<br/></div><div><span>    return 0;</span><br/></div><div>}</div></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 49px;"></col><col style="width: 62px;"></col><col style="width: 181px;"></col><col style="width: 328px;"></col></colgroup><tbody><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt; font-weight: bold;">序号</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 62px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt; font-weight: bold;">返回值</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 181px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt; font-weight: bold;">函数</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 328px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt; font-weight: bold;">说明</span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;">1</div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 62px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">FILE*</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 181px; padding: 8px;"><div><span style="font-size: 9pt;">*fopen()</span></div><ul><li><div><span style="font-size: 9pt;">const char *fname, </span></div></li><li><div><span style="font-size: 9pt;">const char *mode</span></div></li></ul></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 328px; padding: 8px;"><div><span style="font-size: 9pt;">【作用】打开由fname(文件名)指定的文件，返回一个关联该文件的流。并</span><span style="font-size: 9pt;">创建一个缓冲区（在读写模式下会创建两个缓冲区）</span></div><div><span style="font-size: 9pt;">【注意】如果发生错误，返回NULL.。</span></div><div><span style="font-size: 9pt;">【参数】</span></div><ul><li><div><span style="font-size: 9pt;">mode——文件开启模式【见下表】</span></div></li></ul></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;">2</div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 62px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">int</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 181px; padding: 8px;"><div><span style="font-size: 9pt;">fclose()</span></div><ul><li><div><span style="font-size: 9pt;">FILE *stream </span></div></li></ul></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 328px; padding: 8px;"><div><span style="font-size: 9pt;">【作用】关闭给出的文件流，释放已关联到流的所有缓冲区。</span></div><div><span style="font-size: 9pt;">【返回】成功时返回0，否则返回EOF。</span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;">3</div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 62px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">void</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 181px; padding: 8px;"><div><span style="font-size: 9pt;">perror()</span></div><ul><li><div><span style="font-size: 9pt;">const char *str</span></div></li></ul></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 328px; padding: 8px;"><div><span style="font-size: 9pt;">【作用】打印str(字符串)和一个相应的执行定义的错误消息到全局变量errno中。</span></div><div><span style="font-size: 9pt;">【注意】</span><span style="font-size: 9pt;">必须紧跟失败的函数，如果中间执行了标准库函数，将提示Success（每个标准库函数都会修改错误码）</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 49px;"></col><col style="width: 97px;"></col><col style="width: 106px;"></col><col style="width: 100px;"></col><col style="width: 117px;"></col><col style="width: 151px;"></col></colgroup><tbody><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">序号</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">文件打开模式</span></div><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">字符串</span></div></td><td style="text-align: center; vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 106px; padding: 8px;"><div><span style="font-weight: bold; font-size: 9pt;">文件指针位置</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">功能</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 117px; padding: 8px;"><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">打开文件不存在时</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 151px; padding: 8px;"><div style="text-align: center;"><span style="font-weight: bold; font-size: 9pt;">文件存在时</span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">1</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">r【rb】</span></div></td><td rowspan="6" style="vertical-align: middle; height: 200px; border: 1px solid rgb(204, 204, 204); width: 106px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">开头</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">【读】</span></div></td><td rowspan="2" style="vertical-align: middle; height: 56px; border: 1px solid rgb(204, 204, 204); width: 117px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">——</span></div></td><td rowspan="2" style="vertical-align: middle; height: 56px; border: 1px solid rgb(204, 204, 204); width: 151px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">——</span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">2</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">r+【rb+】</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 9pt;">【读】【写】</span></span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">4</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">wx【xb】</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 9pt;">【写】</span></span></div></td><td rowspan="6" style="vertical-align: middle; height: 200px; border: 1px solid rgb(204, 204, 204); width: 117px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">创建新文件</span></div></td><td rowspan="2" style="height: 56px; vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 151px; padding: 8px;"><div><font style="font-size: 9pt;"><span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-weight: bold;-evernote-highlight:true;">该文件已被独占，</span><span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-weight: bold;-evernote-highlight:true;">其他程序</span><span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-weight: bold;-evernote-highlight:true;">再打开就会报错。</span></font></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">5</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">wx+【xb+】</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 9pt;">【读】【写】</span></span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">6</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">w【wb】</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">【写】</span></div></td><td rowspan="2" style="vertical-align: middle; height: 56px; border: 1px solid rgb(204, 204, 204); width: 151px; padding: 8px;"><div><span style="font-size: 9pt;">从开头开始编辑</span></div><div><span style="font-size: 9pt;">【原有内容会被清空】</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">7</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">w+【wb+】</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">【读】【写】</span></div></td></tr><tr><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">8</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">a【ab】</span></div></td><td rowspan="2" style="vertical-align: middle; height: 56px; border: 1px solid rgb(204, 204, 204); width: 106px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">结尾</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">【写】</span></div></td><td rowspan="2" style="vertical-align: middle; height: 56px; border: 1px solid rgb(204, 204, 204); width: 151px; padding: 8px;"><div><span style="font-size: 9pt;">在结尾追加新的内容</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 49px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">9</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 97px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">a+【ab+】</span></div></td><td style="vertical-align: middle; border: 1px solid rgb(204, 204, 204); width: 100px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 9pt;">【读】【写】</span></div></td></tr></tbody></table><ul><li><div>模式中的字母与加号，可以任意排序。</div></li><li><div>UNIX和Linux系统都是文件类型系统，带b字母的模式和不带b字母的模式相同。</div></li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">文件结尾符 EOF</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-weight: bold;">（end of file）</span></div><ul><li><div>定义在stdio.h文件；</div></li><li><div>已被#define宏替换为 -1；</div></li></ul><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 